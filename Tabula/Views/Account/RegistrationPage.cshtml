@model Tabula.Models.Account.RegisterViewModel
@{
    ViewData["Title"] = "Register";
    Layout = "_Account";
}

<div class="row justify-content-center h-auto mt-4">
    <div class="col-md-5">
        <div class="card shadow-lg border-secondary-subtle" style="border-radius:8px; min-height:65vh">
            <div class="card-body">
                <div class="border-bottom my-2">
                    <h3 class="text-center text-primary pb-lg-3">Create a new account</h3>
                </div>
                <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
                <form asp-controller="Account" asp-action="Register" method="post" novalidate>
                    @Html.AntiForgeryToken()

                    <div class="my-3">
                        <label asp-for="Email" class="form-label"></label>
                        <input asp-for="Email" class="form-control @(ViewData.ModelState["Email"]?.Errors.Any() == true ? "is-invalid" : "")" />
                        <span asp-validation-for="Email" class="invalid-feedback"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Username" class="form-label"></label>
                        <input asp-for="Username" class="form-control @(ViewData.ModelState["Username"]?.Errors.Any() == true ? "is-invalid" : "")" />
                        <span asp-validation-for="Username" class="invalid-feedback"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Password" class="form-label"></label>
                        <input asp-for="Password" type="password" id="Password" class="form-control @(ViewData.ModelState["Password"]?.Errors.Any() == true ? "is-invalid" : "")" />
                        <span asp-validation-for="Password" class="invalid-feedback"></span>

                        <div id="passwordValidation" class="list-group mt-2" style="display:none;">
                            <div id="length" class="list-group-item list-group-item-danger small">
                                <i class="bi bi-x-circle me-1"></i> Minimum 8 characters
                            </div>
                            <div id="upper" class="list-group-item list-group-item-danger small">
                                <i class="bi bi-x-circle me-1"></i> At least one uppercase letter
                            </div>
                            <div id="special" class="list-group-item list-group-item-danger small">
                                <i class="bi bi-x-circle me-1"></i> At least one special character
                            </div>
                            <div id="digit" class="list-group-item list-group-item-danger small">
                                <i class="bi bi-x-circle me-1"></i> At least one digit
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label asp-for="ConfirmPassword" class="form-label"></label>
                        <input asp-for="ConfirmPassword" type="password" class="form-control @(ViewData.ModelState["ConfirmPassword"]?.Errors.Any() == true ? "is-invalid" : "")" />
                        <span asp-validation-for="ConfirmPassword" class="invalid-feedback"></span>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 my-3">Register</button>
                    <a asp-action="Index" asp-controller="Account" class="text-center mt-3 d-block">Already have an account?</a>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <script>
        const password = document.getElementById("Password");
        const rules = {
            length: document.getElementById("length"),
            upper: document.getElementById("upper"),
            special: document.getElementById("special"),
            digit: document.getElementById("digit")
        };
        const validationBox = document.getElementById("passwordValidation");

        password.addEventListener("focus", () => validationBox.style.display = "block");
        password.addEventListener("blur", () => validationBox.style.display = "none");

        password.addEventListener("input", () => {
            const val = password.value;

            rules.length.className = val.length >= 8 ? "list-group-item list-group-item-success small" : "list-group-item list-group-item-danger small";
            rules.length.innerHTML = (val.length >= 8 ? '<i class="bi bi-check-circle me-1"></i>' : '<i class="bi bi-x-circle me-1"></i>') + " Minimum 8 characters";

            rules.upper.className = /[A-Z]/.test(val) ? "list-group-item list-group-item-success small" : "list-group-item list-group-item-danger small";
            rules.upper.innerHTML = (/[A-Z]/.test(val) ? '<i class="bi bi-check-circle me-1"></i>' : '<i class="bi bi-x-circle me-1"></i>') + " At least one uppercase letter";

            rules.special.className = /[^A-Za-z0-9\s]/.test(val) ? "list-group-item list-group-item-success small" : "list-group-item list-group-item-danger small";
            rules.special.innerHTML = (/[^A-Za-z0-9\s]/.test(val) ? '<i class="bi bi-check-circle me-1"></i>' : '<i class="bi bi-x-circle me-1"></i>') + " At least one special character";

            rules.digit.className = /\d/.test(val) ? "list-group-item list-group-item-success small" : "list-group-item list-group-item-danger small";
            rules.digit.innerHTML = (/\d/.test(val) ? '<i class="bi bi-check-circle me-1"></i>' : '<i class="bi bi-x-circle me-1"></i>') + " At least one digit";
        });
    </script>
}